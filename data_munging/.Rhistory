# -------------------------
# author: cavazd
# date  : 5/10/2022
# desc  : Code to restructure rlcs_[region]_points.csv for bump chart
# -------------------------
# Load in tidyverse and remove and variables in environment
library(tidyverse)
rm(list=ls())
# load in data for the given region
# -------------------------
region <- "eu"
score_df <- read.csv(
file = paste0("../data/rlcs_", region, "_points.csv"),
stringsAsFactors = T,
)
setwd("~/coding/rlcs_rank_dashboard/data_munging")
source("~/coding/rlcs_rank_dashboard/data_munging/reformat_data.R")
source("~/coding/rlcs_rank_dashboard/data_munging/reformat_data.R")
View(score_df)
vignette("pivot")
score_df %>% pivot_longer(names_to = "event", values_to = "score_change")
score_df %>% pivot_longer(everything(), names_to = "event", values_to = "score_change")
score_df %>% pivot_longer(-team, names_to = "event", values_to = "score_change")
View(rank_df)
score_df %>%
pivot_longer(-team, names_to = "event", values_to = "score_change") %>%
right_join(rank_df, by = c("team", "event"))
score_df %>%
pivot_longer(-team, names_to = "eventname", values_to = "score_change") %>%
right_join(rank_df, by = c("team", "eventname"))
source("~/coding/rlcs_rank_dashboard/data_munging/reformat_data.R")
source("~/coding/rlcs_rank_dashboard/data_munging/reformat_data.R")
source("~/coding/rlcs_rank_dashboard/data_munging/reformat_data.R")
region <- "na"
score_df <- read.csv(
file = paste0("../data/rlcs_", region, "_points.csv"),
stringsAsFactors = T,
)
# create empty dataframe for dataframe stacking
# -------------------------
num_events <- ncol(score_df[-1]) # num of cols without team_name
rank_df <- data.frame()
# add rankings for each event to  rank_df
# -------------------------
for (event in 1:num_events) {
# save to a temp dataframe, select variables from start upto current event
temp_df <- score_df %>% select(1:(event+1)) %>%
# add the score by taking the sum of all event vars
# add event as an int of the current event
mutate('score' = rowSums(select(., 2:(event+1))),
'event' = event) %>%
# remove the different event vars
select(-(2:(event+1))) %>%
# arrange by score and team (alphabetical)
arrange(desc(score), team) %>%
# add ranking after sorting (1 to number of teams)
# add the event name in as well
mutate('ranking' = c(1:nrow(.)),
'eventname' = colnames(score_df)[event+1])
# append the temporary dataframe onto rank_df
rank_df <- rbind(rank_df, temp_df)
}
View(rank_df)
rank_df <- score_df %>%
pivot_longer(-team, names_to = "eventname", values_to = "score_change") %>%
right_join(rank_df, by = c("team", "eventname"))
View(rank_df)
# write transformed data to a new csv file
# -------------------------
write.csv(
x = rank_df,
file = paste0("../data/rlcs_", region, "_ranks.csv"),
row.names = F
)
rank_df <- score_df %>%
pivot_longer(-team, names_to = "eventname", values_to = "score_change") %>%
right_join(rank_df, by = c("team", "eventname")) %>%
mutate(region = region)
View(rank_df)
source("~/coding/rlcs_rank_dashboard/data_munging/reformat_data.R")
source("~/coding/rlcs_rank_dashboard/data_munging/reformat_data.R")
regions = c('na', 'eu')
length(regions)
for (i in 1:length(regions)) {
regions[i]
}
for (i in 1:length(regions)) {
regions[[i]]
}
for (i in 1:length(regions)) {
print(regions[i])
}
# -------------------------
# author: cavazd
# date  : 10/11/2022
# desc  : Code to code to combine rlcs bumpchart data
# -------------------------
regions = c('na', 'eu')
full_df <- data.frame()
for (i in 1:length(regions)) {
this_df <- read.csv(
file = paste0("../data/rlcs_", regions[i], "_ranks.csv"),
stringsAsFactors = T,
)
full_df <- rbind(full_df, this_df)
}
View(full_df)
source("~/coding/rlcs_rank_dashboard/data_munging/combine_data.R")
source("~/coding/rlcs_rank_dashboard/data_munging/combine_data.R")
